<!DOCTYPE html>
<html>
    <head>
        <link href="morpion.css" rel="stylesheet">
        <title>Morpion</title>
        <meta charset="UTF-8"/>
    </head>

    <body>
        <div id="jeu">
            <div>
                <button></button>
                <button></button>
                <button></button>
            </div>
            <div>
                <button></button>
                <button></button>
                <button></button>
            </div>
            <div>
                <button></button>
                <button></button>
                <button></button>
            </div>
            <div id="jeuStatus"></div>
        </div>

        <script type="text/javascript">

            function estvalide(button){
                return button.innerHTML.length == 0; // retourne si il y a quelque chose dans les cases.
            }

            function setSymbol(btn, symbole){
                btn.innerHTML = symbole; //mettre le symbole de l'utillisateur.
            }

            function recherchervainqueur(pions, joueurs, currentTurn){  //retourne true si une solution vainqueur est trouvé
                if (pions[0].innerHTML == joueurs[currentTurn] &&
                    pions[1].innerHTML == joueurs[currentTurn] &&
                    pions[2].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[3].innerHTML == joueurs[currentTurn] &&
                    pions[4].innerHTML == joueurs[currentTurn] &&
                    pions[5].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[6].innerHTML == joueurs[currentTurn] &&
                    pions[7].innerHTML == joueurs[currentTurn] &&
                    pions[8].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[0].innerHTML == joueurs[currentTurn] &&
                    pions[3].innerHTML == joueurs[currentTurn] &&
                    pions[6].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[1].innerHTML == joueurs[currentTurn] &&
                    pions[4].innerHTML == joueurs[currentTurn] &&
                    pions[7].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[2].innerHTML == joueurs[currentTurn] &&
                    pions[5].innerHTML == joueurs[currentTurn] &&
                    pions[8].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[0].innerHTML == joueurs[currentTurn] &&
                    pions[4].innerHTML == joueurs[currentTurn] &&
                    pions[8].innerHTML == joueurs[currentTurn])
                    return true;

                    if (pions[2].innerHTML == joueurs[currentTurn] &&
                    pions[4].innerHTML == joueurs[currentTurn] &&
                    pions[6].innerHTML == joueurs[currentTurn])
                    return true;
                }

                function tableauestplein(pions){ // vérifie si le tableau est plein
                    for(var i = 0, len = pions.length; i < len; i++){
                        if(pions[i].innerHTML.length == 0)
                            return false;
                    }
                    return true;
                }

            var Afficheur = function(element){
                var display = element;

                function setText(message){ // permet de retourner des messages.
                    display.innerHTML = message;
                }
                return {sendMessage : setText};
            }

            function main() {
                var pions = document.querySelectorAll("#jeu button"); // nos boutons
                var joueurs = ['X', 'O']; //nos joueurs
                var currentTurn = 1; // le tour du joueur
                var jeuestfinit = false; // si le jeux est finit
                var afficheur = new Afficheur (document.querySelector("#jeuStatus")); // permet un nouvelle affichage
                afficheur.sendMessage("Le jeu peut démarrer. <br/> Joueur " + joueurs[currentTurn] + " C'est votre tour."); // envoyer ce message pour l'afficher

                for(var i = 0, len = pions.length; i < len; i++){
                    pions[i].addEventListener("click", function(){ // savoir qui est qui au moment de l'action.
                        if(jeuestfinit) // retourne false si le jeux est finit.
                        return;

                        if (!estvalide(this)){
                            afficheur.sendMessage("Déplacement invalide !");
                        } else{
                            setSymbol(this, joueurs[currentTurn]);

                            jeuestfinit = recherchervainqueur(pions, joueurs, currentTurn);

                            //Le jeu est finit (Quelqu'un a gagné)
                            if(jeuestfinit){
                                afficheur.sendMessage("Joueur " + joueurs[currentTurn] + " à gagné !");
                                return;
                            }
                            //Le jeu est finit (Match nul)
                            if(tableauestplein(pions)){
                                afficheur.sendMessage("Match null !!");
                                return;
                            }
                            //Le jeu n'est pas encore fini
                            currentTurn++;//1//2
                            currentTurn = currentTurn % 2;//1//0
                            afficheur.sendMessage("joueur" + joueurs[currentTurn] + " à votre tour !"); // affiche le tour du joueur en question.
                        }
                    });
                }
            }
            main();
        </script>
    </body>

</html>